preload_cards:
  [map, iframe, markdown]
preload_rows:
  [input-select-entity]

anchors:
  ⚓₁: &title
    entity: sensor.placeholder
    tap_action:
      action: none
    hold_action:
      action: none
    type: state-label
  ⚓₂: &title-style
    color: '#bcbebf'
    font-family: SF Text
    font-size: 32px
    font-weight: 500
    cursor: default

button_card_templates:
  homekit:
    show_state: true
    show_icon: false
    aspect_ratio: 1/1
    styles:
      card: &button_styles_card
        - font-family: Sf Display
        - text-rendering: optimizeLegibility
        - font-weight: 400
        - color: 'rgba(255, 255, 255, 0.3)'
        - font-size: 12px
        - background-color: 'rgba(115, 115, 115, 0.2)'
        - border-radius: 10px
        - box-shadow: none
        - transition: none
        - width: 120px
        - height: 120px
      name: &button_styles_name
        - top: 60%
        - left: 10%
        - position: absolute
        - line-height: 2vw
        - font-weight: bold
      state: &button_styles_state
        - top: 75%
        - left: 10%
        - position: absolute
        - line-height: 2vw
      custom_fields:
        icon:
          - top: 10%
          - left: 5%
          - width: 45px
          - position: absolute

  light:
    state: &button_state
      - value: 'on'
        styles:
          card: [background-color: 'rgba(255, 255, 255, 0.8)']
          name: [color: 'rgba(0, 0, 0, 0.6)']
          state: [color: 'rgba(0, 0, 0, 0.6)']
    custom_fields:
      info: >
        [[[ if (entity.state === 'on' && entity.attributes.brightness) {
        const brightness = Math.round(entity.attributes.brightness / 2.54);
        const radius = 20.5; const circumference = radius * 2 * Math.PI; 
        return `<svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="${radius}" stroke="#b2b2b2" stroke-width="1.5" fill="none" style="
        transform: rotate(-90deg); transform-origin: 50% 50%; stroke-dasharray: ${circumference}; stroke-dashoffset: ${circumference - brightness / 100 * circumference};" />
        <text x="50%" y="54%" fill="#8d8e90" font-size="14" text-anchor="middle" alignment-baseline="middle">${brightness}<tspan font-size="8">%</tspan></text></svg>`; } ]]]
    styles:
      custom_fields:
        info: &circle_pos
          - top: 10%
          - right: 5%
          - width: 45px
          - position: absolute
    tap_action:
      action: toggle
      haptic: light
    hold_action:
      action: call-service
      service: browser_mod.popup
      service_data:
        title: Stäng
        deviceID: this
        style:
          --ha-card-border-radius: 1em
          --more-info-header-color: rgba(255,255,255,0.6)
          background: none
          box-shadow: none
        card:
          type: vertical-stack
          cards:
            - type: entities
              title: '[[[ return entity.attributes.friendly_name ]]]'
              style: &popup_style |
                ha-card {
                  animation: pop-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) both; transform-origin: center;
                  box-shadow: none; border-radius: 1em; padding: 0.3em 1.25em 0.4em 0.5em; 
                  background: linear-gradient(180deg, rgba(48,52,52,1) 0%, rgba(48,52,52,1) 4.8em, rgba(34,38,39,1) 4.8em, rgba(34,38,39,1) 100%); }
                .card-header {
                  margin: -0.4em 0 1.4em 0.4em; font-family: sf text; letter-spacing: 0.005em; font-size: 1.5em;}
                @keyframes pop-in {
                  0% { transform: scale(0.6); opacity: 0; } 20% { opacity: 0; } 100% { transform: scale(1); opacity: 0.9; }}
              show_header_toggle: false
              entities:
                - type: custom:light-popup-card
                  entity: '[[[ return entity.entity_id ]]]'
                  icon: none
                  fullscreen: false
                  brightnessWidth: 130px
                  brightnessHeight: 360px
                  borderRadius: 1.7em
                  sliderColor: '#c7c7c7'
                  sliderTrackColor: rgba(25, 25, 25, 0.9)
                  actionSize: 4.5em
                  actionsInARow: 2
                  style: |
                    #popup { 
                      margin: -2.4em 0 1.4em 0; }
                    #popup > div.range-holder > input[type=range] {
                      cursor: grab; }
                    #brightnessValue {
                      color: rgba(255, 255, 255, 0.8); margin: -1em 0 0 0; font-size: 2em; font-weight: 400; 
                      position: absolute; z-index: 100; font-family: SF Display; letter-spacing: 0.02em; pointer-events: none; 
                      mix-blend-mode: difference; text-align:center; width: 3.4em; height: 3.4em; }
                    #popup > div.range-holder > input[type=range]::-webkit-slider-thumb {
                      border: 0; eight: 0; width: 0; cursor: grabbing; }
                    #popup > div.action-holder > div > div {
                      margin: 0.8em 0.5em -0.8em 0.5em; }
                    #popup > div.action-holder > div:nth-child(2) > div:nth-child(2) > span {
                      background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 80%), 
                      conic-gradient(rgb(120,39,230), rgb(230,34,231), rgb(228,5,136), rgb(228,25,25), rgb(229,105,30), rgb(232,226,46), 
                      rgb(125,230,41), rgb(52,232,40), rgb(51,231,92), rgb(52,232,224),rgb(32,125,229), rgb(18,39,229), rgb(120,39,230));
                      border-width: 2px; border-color: #e6e6e6; --size: 4.4em !important; }
                  actions:
                    - service: light.turn_on
                      service_data:
                        entity_id: '[[[ return entity.entity_id ]]]'
                        color_temp: 153
                      color: "#d8d9e1"
                    - service: light.turn_on
                      service_data:
                        entity_id: '[[[ return entity.entity_id ]]]'
                        color_temp: 326
                      color: "#d5b08d"
                    - service: light.turn_on
                      service_data:
                        entity_id: '[[[ return entity.entity_id ]]]'
                        color_temp: 500
                      color: "#ce944b"
                    - service: browser_mod.popup
                      service_data:
                        title: Lumière
                        deviceID: this
                        style:
                          --ha-card-border-radius: 1em
                          --more-info-header-color: rgba(255,255,255,0.6)
                          background: none
                          box-shadow: none
                        card:
                          type: entities
                          title: Färginställningar
                          style: *popup_style
                          show_header_toggle: false
                          entities:
                            - entity: '[[[ return entity.entity_id ]]]'
                              secondary_info: last-changed
                            - type: custom:light-entity-card
                              entity: '[[[ return entity.entity_id ]]]'
                              style:
                                .: |
                                  ha-card {
                                    background: none; box-shadow: none; margin: -0.5em -1em -0.5em -0.7em; }
                                  ha-card > div.light-entity-card-sliders.ha-slider-full-width { 
                                    margin-bottom: 0.75em; }
                                  ha-card > div.light-entity-card-sliders.ha-slider-full-width > div > ha-icon {
                                    margin: auto; width: 34px; height: 34px; cursor: default; 
                                    padding-right: 0.49em; color: var(--paper-item-icon-color);}
                                  ha-card > div.light-entity-card-sliders.ha-slider-full-width > div > div {
                                    margin: auto; padding: 0 1.4em 0 1em; max-width: 1em; cursor: default;}
                                'ha-card > div.light-entity-card-sliders.ha-slider-full-width > div > ha-slider':
                                  $: |
                                    #sliderContainer { 
                                      --calculated-paper-slider-height: var(--paper-slider-height, 5px); }
                              brightness: false
                              color_temp: true
                              full_width_sliders: true
                              header: false
                              show_slider_percent: true
                              smooth_color_wheel: true

title: Home
views:
  - panel: true
    path: default_view
    title: Home
    badges: []
    cards:
      - type: picture-elements
        image: /local/background.png

        elements:

          - prefix: Salon
            <<: *title
            style:
              top: 10%
              left: 30%
              <<: *title-style

          - type: custom:button-card
            entity: light.lampadaire_ikea
            style:
              top: 20%
              left: 30%
            custom_fields:
              icon: >
                [[[ const state = entity.state === 'on' ? 'animate' : null;
                return `<svg viewBox="0 0 50 50"><style>@keyframes animate{0%{transform: scale(0.85);}20%{transform: scale(1.1);}40%{transform: scale(0.95);}60%{transform: scale(1.03);}80%{transform: scale(0.97);}100%{transform: scale(1);}}.animate{animation: animate 0.8s; transform-origin: center;}</style>
                <path fill="#9da0a2" d="M27.4 47.3h-4.9s-.7.1-.7.8.4.9.7.9h4.9c.3 0 .7-.1.7-.9s-.7-.8-.7-.8zm3.3-2.9H19.3s-.8 0-.8.8.6.9.8.9h11.5c.2 0 .8-.1.8-.9-.1-.8-.9-.8-.9-.8zm0-3H19.3s-.8 0-.8.8.6.9.8.9h11.5c.2 0 .8-.1.8-.9-.1-.8-.9-.8-.9-.8zm0-2.9H19.3s-.8 0-.8.8.6.9.8.9h11.5c.2 0 .8-.1.8-.9s-.9-.8-.9-.8zm5.2-23.2c-3.3-5.3-7-5.6-10.9-5.6-3.8 0-8.4.4-10.9 5.6-.1.1-.1.3.1.7.4.8 3.3 7.2 3.2 18.8 0 1.1-.1 1.6 0 1.7 0 .1 0 .7 1.1.7h13c1 0 1-.5 1.1-.7v-1.7c-.1-11.6 2.8-18 3.2-18.8.1-.4.1-.5.1-.7"/>
                <path class="${state}" fill="var(--button-card-light-color-no-temperature)" d="M14.1 15.3c3.4-.3 7-.4 10.9-.4 3.8 0 7.5.2 10.9.4.4-.4.7-.8.9-1.1C39 8.5 38.9 6.5 38.9 6c-.2-4.4-8.4-5-12.1-5h0-3.4c-3.7 0-12 .5-12.1 5 0 .5-.1 2.5 2.1 8.2 0 .3.3.8.7 1.1z"/></svg>`; ]]]
            template:
              - homekit
              - light

          - type: custom:button-card
            entity: light.lampe_chevet_droite
            name: Lampe chevet
            style:
              top: 20%
              left: calc(30% + 150px)
            custom_fields:
              icon: >
                [[[ const state = entity.state === 'on' ? 'animate' : null;
                return `<svg viewBox="0 0 50 50"><style>@keyframes animate{0%{transform: scale(0.85);}20%{transform: scale(1.1);}40%{transform: scale(0.95);}60%{transform: scale(1.03);}80%{transform: scale(0.97);}100%{transform: scale(1);}}.animate{animation: animate 0.8s; transform-origin: center;}</style>
                <path fill="#9da0a2" d="M26.4 25.6c.6-.3 1.1-.7 1.1-1.3L25 17.9l-2.5 6.4c0 .7.6 1.1 1.1 1.3v20.8h-5.5v2.7h13.7v-2.7h-5.5V25.6z"/>
                <path class="${state}" fill="var(--button-card-light-color-no-temperature)" d="M24.6.9l-9.4.5c-.6.1-1.9 0-2.5 2.1s-2.4 9.1-4 16.9c-.2.7-.5 2-.5 2.3s-.4 1.6.9 1.6c.8.1 7.4.3 15.9.3 8.6 0 15.1-.3 15.9-.3 1.3-.1.9-1.3.9-1.6s-.3-1.6-.5-2.3c-1.6-7.8-3.4-14.8-4-16.9s-1.9-2-2.5-2.1c-1.6-.2-6.9-.4-9.4-.5"/> </svg>`;]]]
            template:
              - homekit
              - light


